org.apache.lucene.replicator.http java.io.IOException import java.nio.file.Path import java.util.Collections import org.apache.http.impl.conn.BasicHttpClientConnectionManager import org.apache.lucene.document.Document import org.apache.lucene.index.DirectoryReader import org.apache.lucene.index.IndexWriter import org.apache.lucene.index.IndexWriterConfig import org.apache.lucene.index.SnapshotDeletionPolicy import org.apache.lucene.replicator.IndexReplicationHandler import org.apache.lucene.replicator.IndexRevision import org.apache.lucene.replicator.LocalReplicator import org.apache.lucene.replicator.PerSessionDirectoryFactory import org.apache.lucene.replicator.ReplicationClient import org.apache.lucene.replicator.Replicator import org.apache.lucene.replicator.ReplicatorTestCase import org.apache.lucene.store.Directory import org.apache.lucene.util.IOUtils import org.eclipse.jetty.server.Server import org.eclipse.jetty.servlet.ServletHandler import org.eclipse.jetty.servlet.ServletHolder import org.junit.Before import org.junit.Test import class org.apache.lucene.replicator.http.HttpReplicatorTest super super extends Replicator IndexWriter Server String Path DirectoryReader ReplicationServlet int Directory ServletHandler ServletHolder ReplicationService private private throws decl_stmt ServletHandler = new decl_stmt org.apache.lucene.replicator.http.ReplicationService = new = new decl_stmt ServletHolder = new call ServletHandler.addServletWithMapping() call ServletHandler.addServletWithMapping() call ServletHandler.addServletWithMapping() call ServletHandler.addServletWithMapping() call ServletHandler.addServletWithMapping() + = = = IndexWriterConfig public public throws if = = = = new decl_stmt org.apache.lucene.index.IndexWriterConfig = call org.apache.lucene.index.IndexWriterConfig.setIndexDeletionPolicy(IndexDeletionPolicy) call org.apache.lucene.index.IndexWriterConfig.setIndexDeletionPolicy(IndexDeletionPolicy) call org.apache.lucene.index.IndexWriterConfig.setIndexDeletionPolicy(IndexDeletionPolicy) call org.apache.lucene.index.IndexWriterConfig.setIndexDeletionPolicy(IndexDeletionPolicy) call org.apache.lucene.index.IndexWriterConfig.setIndexDeletionPolicy(IndexDeletionPolicy) new call org.apache.lucene.index.IndexWriterConfig.getIndexDeletionPolicy() call org.apache.lucene.index.IndexWriterConfig.getIndexDeletionPolicy() call org.apache.lucene.index.IndexWriterConfig.getIndexDeletionPolicy() call org.apache.lucene.index.IndexWriterConfig.getIndexDeletionPolicy() call org.apache.lucene.index.IndexWriterConfig.getIndexDeletionPolicy() = new = public public throws call org.apache.lucene.index.IndexWriter.rollback() call org.apache.lucene.index.IndexWriter.rollback() call org.apache.lucene.index.IndexWriter.rollback() call org.apache.lucene.index.IndexWriter.rollback() call org.apache.lucene.index.IndexWriter.rollback() Document private private throws decl_stmt org.apache.lucene.document.Document = new call org.apache.lucene.index.IndexWriter.addDocument(Iterable) call org.apache.lucene.index.IndexWriter.addDocument(Iterable) call org.apache.lucene.index.IndexWriter.addDocument(Iterable) call org.apache.lucene.index.IndexWriter.addDocument(Iterable) call org.apache.lucene.index.IndexWriter.addDocument(Iterable) call org.apache.lucene.index.IndexWriter.setCommitData(Map,boolean) call org.apache.lucene.index.IndexWriter.setCommitData(Map,boolean) call org.apache.lucene.index.IndexWriter.setCommitData(Map,boolean) call org.apache.lucene.index.IndexWriter.setCommitData(Map,boolean) call org.apache.lucene.index.IndexWriter.setCommitData(Map,boolean) call org.apache.lucene.index.IndexWriter.commit(SegmentInfos) call org.apache.lucene.index.IndexWriter.commit(SegmentInfos) call org.apache.lucene.index.IndexWriter.commit(SegmentInfos) call org.apache.lucene.index.IndexWriter.commit(SegmentInfos) call org.apache.lucene.index.IndexWriter.commit(SegmentInfos) call Replicator.publish() call Replicator.publish() call Replicator.publish() call Replicator.publish() call Replicator.publish() new DirectoryReader private private throws decl_stmt org.apache.lucene.index.DirectoryReader = call DirectoryReader.close() call DirectoryReader.close() call DirectoryReader.close() call DirectoryReader.close() call DirectoryReader.close() = ReplicationClient Replicator public public throws decl_stmt org.apache.lucene.replicator.Replicator = new + decl_stmt org.apache.lucene.replicator.ReplicationClient = new new new call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call org.apache.lucene.replicator.ReplicationClient.close() call org.apache.lucene.replicator.ReplicationClient.close() call org.apache.lucene.replicator.ReplicationClient.close() call org.apache.lucene.replicator.ReplicationClient.close() call org.apache.lucene.replicator.ReplicationClient.close() BasicHttpClientConnectionManager ReplicationClient Replicator public public throws decl_stmt BasicHttpClientConnectionManager = new decl_stmt org.apache.lucene.replicator.Replicator = new + decl_stmt org.apache.lucene.replicator.ReplicationClient = new new new try try call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() catch call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call org.apache.lucene.replicator.ReplicationClient.updateNow() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call DirectoryReader.getIndexCommit() call org.apache.lucene.replicator.ReplicationClient.close() call org.apache.lucene.replicator.ReplicationClient.close() call org.apache.lucene.replicator.ReplicationClient.close() call org.apache.lucene.replicator.ReplicationClient.close() call org.apache.lucene.replicator.ReplicationClient.close() finally